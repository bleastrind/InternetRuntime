<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>start.html</title>
	
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <script type="text/javascript" src="js/jquery/jquery-1.6.1.js"></script>
    
    <!--<link rel="stylesheet" type="text/css" href="./styles.css">-->
    
<script>
var accessToken = "FEIFEI";
var result;
var apps;
var triggerChannel;
var actionChannel; 
var signals = new Array();
var appsByTri = [];

function submit_accessToken()
{
	var params={
			'accessToken':accessToken
	}
	$.ajax({
		url:'servlet/accessTokenServlet',
		type: 'POST',
		data: params,
		dataType: 'json',
		success : function(data)
		{
			result = eval(data);
			apps = result.applications;
			for(var i in apps)
			{
				var tempSig = apps[i].signals;
				signals = signals.concat(tempSig);
			}
			removeRepeat();
			start();
		}
	
	}
			)
			
}

function removeRepeat()
{
	for(var i = 0; i< signals.length; i++){
		for(var j = i+1; j<signals.length;j++){
			if(signals[i].signalName==signals[j].signalName)
				{
					signals.splice(j,1);
					j--;
				}
		}
	}
	
	
}

function start()
{
	choose_trigger();
}

function choose_trigger()
{                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	var html = "";
	for(var i = 0; i< signals.length; i++)
	{
		html +='<div>'+'<a href="#" onclick="choose_trigger_id('+i+')">'
						+signals[i].signalName
					+'</a>'+'</div>';
		html +='<div>'+signals[i].signalDescription+'<div>';
	}
		$("#choose_trigger").html(html);
}

function choose_trigger_id(id)
{
	var trigger = signals[id].signalName;
	getTriggerChannels(trigger);
	render_triggerChannels();
}

function getTriggerChannels(trigger){
	var signals;
	var request;
	
	for(var j = 0; j<apps.length; j++)
	{
		signals = apps[j].signals;
		for(var i = 0; i<signals.length; i++)
		{
			request = signals[i].signalName;
			if(request==trigger)
			{
				appsByTri.push(apps[j].appName);
			}
		}
	}
}


function render_triggerChannels()
{
	var html = "";
	
	for(var i = 0; i< appsByTri.length; i++)
	{
		
		html += '<a onclick="choose_triggerChannel_id('+i+')">'
						+'<img src="'+ "images/"+appsByTri[i]+"_logo.jpg" +'">'
					+'</a>';
	}
		$("#choose_triggerChannel").html(html);
}

function choose_triggerChannel_id(id)
{
	triggerChannel = appsByTri[id];
	alert(triggerChannel);
	render_actionChannels();
}

function render_actionChannels()
{
	var html = "";
	
	for(var i = 0; i< apps.length; i++)
	{
		
		html += '<a onclick="choose_actionChannel_id('+i+')">'
						+'<img src="'+ "images/"+apps[i].appName+"_logo.jpg" +'">'
					+'</a>';
	}
		$("#choose_actionChannel").html(html);
	
}

function choose_actionChannel_id(id)
{
	actionChannel = apps[id].appName;
	alert(actionChannel);
	submit_action();
}

////////////////////////////////////////////////////////////////////////////////////////////////////

function submit_action()
{
	var url='submitaction';
	var params={
			'trigger':trigger,
			'triggerChannel':triggerChannel,
			'actionChannel':actionChannel
	}
	
	$.post(url,params,postsuc);  
}

function postsuc(data)
{
}



</script>

</head>
<body>
	<div id="submitButton">
		<input type="button" name="Click here to start" value="Submit" onclick="submit_accessToken()">
	</div>
	
	<div id = "choose_trigger">	
	</div>
	
	<div id = "choose_triggerChannel">
	</div>
		
	<div id = "choose_actionChannel">
	</div>
	
</body>
</html>