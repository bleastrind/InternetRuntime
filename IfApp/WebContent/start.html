<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Requesting with access token</title>

<script type="text/javascript" src="js/jquery/jquery-1.6.1.js">
</script>

<script>

var accessToken = "FEIFEI";
var result;
var apps;
var trigger;
var triggerChannel;
var actionChannel;

var appsByTri = new Array();
var signals = new Array();

function submit_accessToken()
{
	var params={
			'accessToken':accessToken
	}
	$.ajax({
		url:'submitAccessToken',
		type: 'POST',
		data: params,
		dataType: 'json',
		success : function(data)
		{
			result = eval(data);
			apps = result.apps;
			for(var i in apps)
			{
				var tempSig = apps[i].signals;
				signals = signals.concat(tempSig);
			}
			removeRepeat();
		}
	
	}
			)
}

function removeRepeat()
{
	for(var i = 0; i< signals.length; i++){
		for(var j = i+1; j<signals.length;j++){
			if(signals[i]==signals[j])
				{
					signals.splice(j,1);
					j--;
				}
		}
	}
	
	start();
}

function start()
{
	choose_trigger();
}

function choose_trigger()
{                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	var html = "";
	for(var i = 0; i< signals.length; i++)
	{
		html +='<div>'+'<a href="#" onclick="choose_trigger_id('+i+')">'
						+signals[i]
					+'</a>'+'</div>';
	}
		$("#choose_trigger").html(html);
}

function choose_trigger_id(id)
{
	trigger = signals[id];
	alert(trigger);
	getTriggerChannel();
}

function getTriggerChannel(){
	var signalsName;
	var request;
	for(var j = 0; j<apps.length; j++)
	{
		signalsName = apps[j].signals;
		for(var i = 0; i<signalsName.length; i++)
		{
			request = signalsName[i];
			if(request==trigger)
			{
				appsByTri.push(apps[j].appName);
			}
		}
	}
	
	choose_triggerChannel();
}


function choose_triggerChannel()
{
	var html = "";
	
	for(var i = 0; i< appsByTri.length; i++)
	{
		
		html += '<a onclick="choose_triggerChannel_id('+i+')">'
						+'<img src="'+ "images/"+appsByTri[i]+"_logo.jpg" +'">'
					+'</a>';
	}
		$("#choose_triggerChannel").html(html);
}

function choose_triggerChannel_id(id)
{
	triggerChannel = appsByTri[id];
	alert(triggerChannel);
	choose_actionChannel();
}

function choose_actionChannel()
{
	var html = "";
	
	for(var i = 0; i< apps.length; i++)
	{
		
		html += '<a onclick="choose_actionChannel_id('+i+')">'
						+'<img src="'+ "images/"+apps[i].appName+"_logo.jpg" +'">'
					+'</a>';
	}
		$("#choose_actionChannel").html(html);
	
}

function choose_actionChannel_id(id)
{
	actionChannel = apps[id].appName;
	alert(actionChannel);
	submit_action();
}

////////////////////////////////////////////////////////////////////////////////////////////////////

function submit_action()
{
	var url='submitaction';
	var params={
			'trigger':trigger,
			'triggerChannel':triggerChannel,
			'actionChannel':actionChannel
	}
	
	$.post(url,params,postsuc);  
}

function postsuc(data)
{
}



</script>

</head>
<body>
	<div id="submitButton">
		<input type="button" name="Click here to start" value="Submit" onclick="submit_accessToken()">
	</div>
	
	<div id = "choose_trigger">	
	</div>
	
	<div id = "choose_triggerChannel">
	</div>
		
	<div id = "choose_actionChannel">
	</div>
	
</body>
</html>